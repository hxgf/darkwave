<!DOCTYPE html>
<html>
<head>

	<title>{{title}}</title>

	<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/images/favicons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/images/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png">

	<link rel="stylesheet" href="/css/lib/tachyons.min.css" />
	<link rel="stylesheet" href="/css/lib/darkwave.css" />

	<link rel="stylesheet" href="/css/lib/smoke.darkwave.css" />
	<!-- <link rel="stylesheet" href="/css/lib/font-awesome.min.css" /> -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" href="/css/admin.css?v=2" />
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,400,700|Roboto:300,400,700" rel="stylesheet">

</head>
<body>



{{#if locals.auth}}

	<!-- admin shell -->
	{{#if locals.is_admin}}

	<header class="flex justify-between bg-black-90 w-100 ph3 pv3 pv4-ns ph4-m ph5-l">

	  <nav class="f5 fw6 ttu tracked flex-grow">
	    <a class="{{#if current_home}}white{{else}}white-70{{/if}} hover-white dib mr4 roboto fw4 no-underline" href="/admin" title="Home">▲▼</a>
	  </nav>

		<div class="f3 fw6 flex tr">
	    <a class="{{#if current_system}}white{{else}}white-30{{/if}} hover-white dib v-mid" href="/admin/users" title="Site Management"><i class="fa fa-sliders" aria-hidden="true"></i></a>
		</div>

	</header>

  {{outlet}}

	{{else}}

	<div class="dt h-100 center pv5">
	  <div class="dtc v-mid f4">
			∅
	  </div>
	</div>

	{{/if}}

{{else}}

	<!-- login form -->

	<div class="dt h-100 w-100 w-60-m w-50-l center pv5-ns pv4 ph4">
		<div class="dtc v-mid lh-copy">
			<img src="/images/lib/placeholder.png" class="db center mb5 w-70" />

			<div class="login" x-data="login_form()">

				<div class="mb4 validate-email login-field">
					<label class="db mb2 roboto ttu b f6">Email Address / Screen Name</label>
					<input class="db w-100 pa2 f5 br1" type="text" name="email" x-on:keydown.enter="login()"
						x-on:blur="clear_error('validate-email')" />
					<span class="db f6 pt2"></span>
				</div>

				<div class="mb4 pb2 validate-password login-field">
					<label class="db mb2 roboto ttu b f6">Password</label>
					<input class="db w-100 pa2 f5 br1" type="password" name="password" x-on:keydown.enter="login()"
						x-on:blur="clear_error('validate-password')" />
					<span class="db f6 pt2"></span>
				</div>

				<div class="dn">
					<input type="text" name="website" />
				</div>

				<input type="hidden" name="ip" value="{{ip}}" />
				<input type="hidden" name="redirect" value="{{redirect}}" />

				<button class="roboto ttu f5 br2 db pv3 w-100 bg-near-black hover-bg-black-80 white bn b mb4 pointer" @click="login()">Login</button>

				<div class="tc">
					<a class="black-50 hover-black-70 f6 u" href="/forgot">Forgot password?</a>
				</div>
			</div>

		</div>
	</div>

	<script>
		function login_form() {
			return {
				clear_error: function (class_name) {
					document.querySelector('.' + class_name).classList.remove('error');
					document.querySelector('.' + class_name + ' span').innerHTML = '';
				},
				login: function () {
					document.body.classList.add('working');
					dw.api_request({
						url: '/auth/login/process',
						data: {
							email: document.querySelector('[name="email"]').value,
							password: document.querySelector('[name="password"]').value,
							redirect: document.querySelector('[name="redirect"]').value,
							website: document.querySelector('[name="website"]').value,
							ua: navigator.userAgent,
							ip: document.querySelector('[name="ip"]').value
						},
						callback: function (r) {
							document.body.classList.remove('working');
							if (r.success) {
								if (r.redirect) {
									window.location.href = r.redirect;
								} else {
									//								window.location.href = '/';
									window.location.reload();
								}
							} else {
								if (r.error) {
									if (r.error.email) {
										document.body.classList.remove('working');
										document.querySelector('.validate-email').classList.add('error');
										document.querySelector('.validate-email span').innerHTML = r.error.message;
									}
									if (r.error.password) {
										document.body.classList.remove('working');
										document.querySelector('.validate-password').classList.add('error');
										document.querySelector('.validate-password span').innerHTML = r.error.message;
									}
								}
							}
						}
					});
				}
			}
		}
	</script>

{{/if}}

	<!-- global working state -->

	<div class="loader-container">
		<div class="loader three-quarters-loader"></div>
	</div>

	<script src="/js/lib/js.cookie.min.js"></script>
	<script src="/js/lib/smoke.min.js"></script>

	<script src="/js/lib/darkwave.js"></script>
	<script src="/js/lib/alpine.min.js"></script>
	<script src="/js/lib/instant.page.min.js" type="module" defer></script>

</body>
</html>
